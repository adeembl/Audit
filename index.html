<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flash Audit Renault - Proceso L√≠nea</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1, h2 { background: #f2f2f2; padding: 10px; }
    label { font-weight: bold; margin-right: 5px; }
    input[type="text"], input[type="date"], input[type="time"], select { margin-bottom: 10px; padding: 5px; width: 200px; }
    textarea { margin-bottom: 10px; padding: 5px; width: 100%; height: 60px; }
    .postit { background-color: #ffffcc; padding: 10px; margin-bottom: 10px; border: 1px dashed #ccc; }
    .comentario-textarea { width: 100%; height: 60px; margin-top: 5px; padding: 5px; resize: vertical; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    table, th, td { border: 1px solid #ccc; }
    th { background: #eaecee; text-align: left; padding: 5px; }
    td { padding: 5px; vertical-align: top; }
    .form-group { margin-bottom: 10px; }
    button { padding: 10px 20px; font-size: 14px; cursor: pointer; margin-right: 10px; }
    .ratingSelect { width: 70px; }
    .resultado-ok { font-weight: bold; margin-top: 10px; font-size: 14px; }
    img.preview { display: block; margin-top: 5px; max-width: 500px; border: 1px solid #ccc; }
    .mini { width: 280px; max-width: 100%; }
    .row { display: flex; flex-wrap: wrap; gap: 12px; align-items: flex-end; }
    .row .col { display: inline-flex; flex-direction: column; }
    .sublabel { display:block; font-weight:bold; margin-top:4px; }

    /* Dashboard Econ√≥mico - Estilos del Carrusel */
    .economic-dashboard {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 15px;
      padding: 30px;
      margin: 20px 0 30px 0;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      position: relative;
      overflow: hidden;
    }
    .dashboard-header {
      text-align: center;
      color: white;
      margin-bottom: 20px;
    }
    .dashboard-header h2 {
      background: transparent;
      color: white;
      font-size: 28px;
      margin: 0 0 10px 0;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    .carousel-container {
      position: relative;
      width: 100%;
      height: 500px;
      overflow: hidden;
    }
    .carousel-slide {
      position: absolute;
      width: 100%;
      height: 100%;
      opacity: 0;
      transition: opacity 0.8s ease-in-out;
      background: white;
      border-radius: 10px;
      padding: 25px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.2);
    }
    .carousel-slide.active {
      opacity: 1;
      z-index: 1;
    }
    .slide-title {
      text-align: center;
      color: #667eea;
      font-size: 24px;
      margin-bottom: 20px;
      font-weight: bold;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      transition: transform 0.3s;
    }
    .stat-card:hover {
      transform: translateY(-5px);
    }
    .stat-value {
      font-size: 32px;
      font-weight: bold;
      margin: 10px 0;
    }
    .stat-label {
      font-size: 14px;
      opacity: 0.9;
    }
    .stat-trend {
      font-size: 12px;
      margin-top: 5px;
    }
    .chart-container {
      position: relative;
      height: 300px;
      margin-top: 20px;
    }
    .carousel-indicators {
      text-align: center;
      margin-top: 15px;
    }
    .indicator {
      display: inline-block;
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: rgba(255,255,255,0.4);
      margin: 0 5px;
      cursor: pointer;
      transition: background 0.3s;
    }
    .indicator.active {
      background: white;
      width: 30px;
      border-radius: 6px;
    }

    @media (max-width: 640px){
      input[type="text"], input[type="date"], input[type="time"], select { width: 100%; }
      .stats-grid { grid-template-columns: 1fr; }
      .carousel-container { height: 600px; }
    }
  </style>
</head>
<body>

  <h1 id="titulo">FLASH AUDIT - Proceso L√≠nea <span id="lineaTitulo">3</span></h1>

  <!-- Dashboard Econ√≥mico con Carrusel Autom√°tico -->
  <div class="economic-dashboard">
    <div class="dashboard-header">
      <h2>üìä Dashboard Econ√≥mico - An√°lisis en Tiempo Real</h2>
      <p style="color: rgba(255,255,255,0.9); margin: 0;">Estad√≠sticas actualizadas | Rotaci√≥n autom√°tica cada 5 segundos</p>
    </div>

    <div class="carousel-container">
      <!-- Slide 1: KPIs Principales -->
      <div class="carousel-slide active" data-slide="0">
        <div class="slide-title">üìà Indicadores Clave de Rendimiento (KPIs)</div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Producci√≥n Diaria</div>
            <div class="stat-value">1,247</div>
            <div class="stat-trend">‚Üë +8.3% vs ayer</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Eficiencia Global (OEE)</div>
            <div class="stat-value">87.5%</div>
            <div class="stat-trend">‚Üë +2.1% este mes</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Coste por Unidad</div>
            <div class="stat-value">‚Ç¨24.80</div>
            <div class="stat-trend">‚Üì -3.2% optimizado</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Calidad (FTQ)</div>
            <div class="stat-value">96.2%</div>
            <div class="stat-trend">‚Üë +1.5% mejorado</div>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="kpiChart"></canvas>
        </div>
      </div>

      <!-- Slide 2: Costes Operativos -->
      <div class="carousel-slide" data-slide="1">
        <div class="slide-title">üí∞ An√°lisis de Costes Operativos</div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Mano de Obra</div>
            <div class="stat-value">‚Ç¨12,450</div>
            <div class="stat-trend">45% del total</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Materiales</div>
            <div class="stat-value">‚Ç¨9,820</div>
            <div class="stat-trend">35% del total</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Energ√≠a</div>
            <div class="stat-value">‚Ç¨3,280</div>
            <div class="stat-trend">12% del total</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Mantenimiento</div>
            <div class="stat-value">‚Ç¨2,210</div>
            <div class="stat-trend">8% del total</div>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="costChart"></canvas>
        </div>
      </div>

      <!-- Slide 3: Producci√≥n Semanal -->
      <div class="carousel-slide" data-slide="2">
        <div class="slide-title">üì¶ Evoluci√≥n de Producci√≥n Semanal</div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Meta Semanal</div>
            <div class="stat-value">8,500</div>
            <div class="stat-trend">Objetivo establecido</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Producci√≥n Real</div>
            <div class="stat-value">8,847</div>
            <div class="stat-trend">‚Üë +4.1% sobre meta</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Unidades Defectuosas</div>
            <div class="stat-value">334</div>
            <div class="stat-trend">3.8% del total</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Tiempo Ciclo Prom.</div>
            <div class="stat-value">4.2 min</div>
            <div class="stat-trend">‚Üì -0.3 min optimizado</div>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="productionChart"></canvas>
        </div>
      </div>

      <!-- Slide 4: Rentabilidad -->
      <div class="carousel-slide" data-slide="3">
        <div class="slide-title">üíπ An√°lisis de Rentabilidad</div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Ingresos Mensuales</div>
            <div class="stat-value">‚Ç¨142,300</div>
            <div class="stat-trend">‚Üë +12.5% vs mes anterior</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Costes Totales</div>
            <div class="stat-value">‚Ç¨98,450</div>
            <div class="stat-trend">‚Üì -3.8% optimizado</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Margen Bruto</div>
            <div class="stat-value">‚Ç¨43,850</div>
            <div class="stat-trend">30.8% margen</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">ROI Trimestral</div>
            <div class="stat-value">22.4%</div>
            <div class="stat-trend">‚Üë +5.2% mejorado</div>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="profitChart"></canvas>
        </div>
      </div>

      <!-- Slide 5: Tiempo de Inactividad -->
      <div class="carousel-slide" data-slide="4">
        <div class="slide-title">‚è±Ô∏è An√°lisis de Tiempos de Inactividad</div>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">Tiempo Productivo</div>
            <div class="stat-value">92.3%</div>
            <div class="stat-trend">‚Üë +1.8% mejorado</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Paradas No Planificadas</div>
            <div class="stat-value">4.2%</div>
            <div class="stat-trend">‚Üì -0.9% reducido</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Mantenimiento Preventivo</div>
            <div class="stat-value">2.8%</div>
            <div class="stat-trend">Planificado</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Cambios de Turno</div>
            <div class="stat-value">0.7%</div>
            <div class="stat-trend">Normal</div>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="downtimeChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Indicadores de navegaci√≥n -->
    <div class="carousel-indicators">
      <span class="indicator active" onclick="goToSlide(0)"></span>
      <span class="indicator" onclick="goToSlide(1)"></span>
      <span class="indicator" onclick="goToSlide(2)"></span>
      <span class="indicator" onclick="goToSlide(3)"></span>
      <span class="indicator" onclick="goToSlide(4)"></span>
    </div>
  </div>

  <!-- Datos generales -->
  <div class="form-group">
    <div class="row">
      <div class="col">
        <label for="fecha">Fecha:</label>
        <input type="date" id="fecha" name="fecha" required />
      </div>
      <div class="col">
        <label for="auditor">Auditor:</label>
        <input type="text" id="auditor" name="auditor" placeholder="Nombre auditor" required />
      </div>
      <div class="col">
        <label for="responsable">Responsable:</label>
        <input type="text" id="responsable" name="responsable" placeholder="Responsable de √Årea" required />
      </div>
    </div>
    <div class="row">
      <div class="col">
        <label for="modelo">Modelo:</label>
        <input type="text" id="modelo" name="modelo" placeholder="Modelo" required />
      </div>
      <div class="col">
        <label for="linea">L√≠nea:</label>
        <select id="linea" name="linea" required>
          <option value="">Seleccione</option>
          <option value="L√≠nea 1">L√≠nea 1</option>
          <option value="L√≠nea 2">L√≠nea 2</option>
          <option value="L√≠nea 3" selected>L√≠nea 3</option>
        </select>
      </div>
      <div class="col">
        <label for="turno">Turno:</label>
        <select id="turno" name="turno" required>
          <option value="">Seleccione</option>
          <option value="Ma√±ana">Ma√±ana</option>
          <option value="Tarde">Tarde</option>
          <option value="Noche">Noche</option>
        </select>
      </div>
      <div class="col">
        <label for="hora">Hora:</label>
        <input type="time" id="hora" name="hora" required />
      </div>
    </div>
  </div>

  <!-- OPERACIONES -->
  <h2>OPERACIONES</h2>
  <table id="tablaOperaciones">
    <thead>
      <tr>
        <th style="width: 5%;">N¬∫</th>
        <th style="width: 75%;">Descripci√≥n de la Operaci√≥n</th>
        <th style="width: 20%;">Puntuaci√≥n (1-5)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td>Extracci√≥n del techo de la Water Jet y colocaci√≥n en mesa auxiliar.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>2</td>
        <td>Verificaci√≥n de ausencia de pepitas en la cuna de Water Jet.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>3</td>
        <td>Accionamiento del cierre de la puerta de la Water Jet.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>4</td>
        <td>Eliminaci√≥n de recortes y pepitas.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>5</td>
        <td>Verificaci√≥n de ausencia de defectos (roturas, irregularidades en el corte).</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>6</td>
        <td>Dejar techo en m√°quina de pegado de componentes y accionar ciclo.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>7</td>
        <td>Repaso del techo con cepillo.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
    </tbody>
  </table>

  <!-- FRECUENCIALES -->
  <h2>FRECUENCIALES</h2>
  <table id="tablaFrecuenciales">
    <thead>
      <tr>
        <th style="width: 5%;">N¬∫</th>
        <th style="width: 75%;">Descripci√≥n de la Operaci√≥n</th>
        <th style="width: 20%;">Puntuaci√≥n (1-5)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>7</td>
        <td>Inicio del sistema inform√°tico y captura de datos.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>8</td>
        <td>Rellenado del parte de trabajo.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>9</td>
        <td>Orden y limpieza seg√∫n estado de referencia.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>10</td>
        <td>Mantenimiento primario.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>11</td>
        <td>Apoyo en preparaci√≥n y cierre de contenedores.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>12</td>
        <td>Cambio de pl√°stico y preparaci√≥n de molde.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>13</td>
        <td>Retiro de carro de recortes y entrada de uno nuevo.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
    </tbody>
  </table>

  <!-- AUTOCONTROL -->
  <h2>AUTOCONTROL</h2>
  <table id="tablaAutocontrol">
    <thead>
      <tr>
        <th style="width: 5%;">N¬∫</th>
        <th style="width: 75%;">Descripci√≥n</th>
        <th style="width: 20%;">Puntuaci√≥n (1-5)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>14</td>
        <td>Verificaci√≥n de la primera pieza (OK 1¬™ pieza).</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>15</td>
        <td>Paso horario de control de calidad.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>16</td>
        <td>Autocontrol de la pieza terminada.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>17</td>
        <td>Rellenar Diario WJ</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
    </tbody>
  </table>

  <!-- PROHIBICIONES -->
  <h2>PROHIBICIONES</h2>
  <table id="tablaProhibiciones">
    <thead>
      <tr>
        <th style="width: 5%;">N¬∫</th>
        <th style="width: 75%;">Prohibici√≥n</th>
        <th style="width: 20%;">Puntuaci√≥n (1-5)</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td>No anular los sistemas de seguridad de la maquinaria.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>2</td>
        <td>No desechar techos defectuosos sin registrarlos.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>3</td>
        <td>No acumular recortes en exceso en el carro.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>4</td>
        <td>No utilizar elementos de corte distintos a las tijeras.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
      </tr>
      <tr>
        <td>5</td>
        <td>No embalar techos por parte del operario WJ.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option>
          <option value="5">5</option>
        </select></td>
      </tr>
    </tbody>
  </table>

  <!-- GP12 -->
  <h2>GP12</h2>
  <table id="tablaGP12">
    <thead>
      <tr>
        <th style="width: 5%;">N¬∫</th>
        <th style="width: 65%;">Descripci√≥n</th>
        <th style="width: 15%;">Puntuaci√≥n (1-5)</th>
        <th style="width: 15%;">Adjuntar Imagen</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td>Revisi√≥n final de contenedor por el jefe de l√≠nea.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
        <td><input type="file" accept="image/*" capture="environment" onchange="previewImage(this)"><img class="preview" alt=""></td>
      </tr>
      <tr>
        <td>2</td>
        <td>Correcto uso del scanner.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
        <td><input type="file" accept="image/*" capture="environment" onchange="previewImage(this)"><img class="preview" alt=""></td>
      </tr>
      <tr>
        <td>3</td>
        <td>Sello tras revisi√≥n de techos por el operario.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
        <td><input type="file" accept="image/*" capture="environment" onchange="previewImage(this)"><img class="preview" alt=""></td>
      </tr>
      <tr>
        <td>4</td>
        <td>Colocaci√≥n de la etiqueta aceptado por el jefe de l√≠nea.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
        <td><input type="file" accept="image/*" capture="environment" onchange="previewImage(this)"><img class="preview" alt=""></td>
      </tr>
      <tr>
        <td>5</td>
        <td>Colocaci√≥n de contenedor nuevo tras retirada del mismo.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
        <td><input type="file" accept="image/*" capture="environment" onchange="previewImage(this)"><img class="preview" alt=""></td>
      </tr>
    </tbody>
  </table>

  <!-- SENSORES DE LA WATER JET -->
  <h2>SENSORES DE LA WATER JET</h2>
  <table id="tablaSensoresWaterJet">
    <thead>
      <tr>
        <th style="width: 5%;">N¬∫</th>
        <th style="width: 65%;">Descripci√≥n del Sensor</th>
        <th style="width: 15%;">Puntuaci√≥n (1-5)</th>
        <th style="width: 15%;">Adjuntar Imagen</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td>Revisi√≥n del funcionamiento de los sensores en el sistema Water Jet.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
        <td><input type="file" accept="image/*" capture="environment" onchange="previewImage(this)"><img class="preview" alt=""></td>
      </tr>
    </tbody>
  </table>

  <!-- ONDULACIONES O IRREGULARIDADES EN QUARTER GLASS -->
  <h2>ONDULACIONES O IRREGULARIDADES EN QUARTER GLASS</h2>
  <table id="tablaQuarterGlass">
    <thead>
      <tr>
        <th style="width: 5%;">N¬∫</th>
        <th style="width: 65%;">Descripci√≥n</th>
        <th style="width: 15%;">Puntuaci√≥n (1-5)</th>
        <th style="width: 15%;">Adjuntar Imagen</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td>Verificaci√≥n de ondulaciones o irregularidades en Quarter Glass.</td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
        <td><input type="file" accept="image/*" capture="environment" onchange="previewImage(this)"><img class="preview" alt=""></td>
      </tr>
    </tbody>
  </table>

  <!-- PROBETAS (AGUA Y ADHESIVO) - MISMA DIN√ÅMICA -->
  <h2>PROBETAS (AGUA Y ADHESIVO)</h2>
  <table id="tablaProbetas">
    <thead>
      <tr>
        <th style="width: 5%;">N¬∫</th>
        <th style="width: 65%;">Descripci√≥n de la Probeta</th>
        <th style="width: 15%;">Puntuaci√≥n (1-5)</th>
        <th style="width: 15%;">Adjuntar Imagen</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td>
          Probeta de agua
          <div>
            <span class="sublabel">Valor:</span>
            <input type="text" id="idProbetaAgua" placeholder="" style="width:180px;">
          </div>
          
        </td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
        <td>
          <input type="file" accept="image/*" capture="environment" onchange="previewImage(this)">
          <img class="preview" alt="">
        </td>
      </tr>
      <tr>
        <td>2</td>
        <td>
          Probeta de adhesivo
          <div>
            <span class="sublabel">Valor:</span>
            <input type="text" id="idProbetaAdhesivo" placeholder="" style="width:180px;">
          </div>
          
        </td>
        <td><select class="ratingSelect" onchange="onValueChanged()">
          <option value=""></option><option value="1">1</option><option value="2">2</option>
          <option value="3">3</option><option value="4">4</option><option value="5">5</option>
        </select></td>
        <td>
          <input type="file" accept="image/*" capture="environment" onchange="previewImage(this)">
          <img class="preview" alt="">
        </td>
      </tr>
    </tbody>
  </table>

  <!-- NOTAS / COMENTARIOS ADICIONALES -->
  <h2>NOTAS / COMENTARIOS ADICIONALES</h2>
  <div id="comentariosContainer"></div>
  <button type="button" onclick="addPostit()">Agregar Post-it</button>

  <p class="resultado-ok">Puntuaci√≥n media (1-5): <span id="averageRating">0.00</span></p>
  <button type="button" onclick="generarPDF()">Generar PDF</button>

  <!-- Librer√≠as -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>

  <script>
    // ====== DASHBOARD ECON√ìMICO - CARRUSEL AUTOM√ÅTICO ======
    let currentSlide = 0;
    const totalSlides = 5;
    let autoplayInterval;
    let charts = {};

    // Funci√≥n para cambiar de slide
    function goToSlide(slideIndex) {
      const slides = document.querySelectorAll('.carousel-slide');
      const indicators = document.querySelectorAll('.indicator');

      slides.forEach(slide => slide.classList.remove('active'));
      indicators.forEach(indicator => indicator.classList.remove('active'));

      slides[slideIndex].classList.add('active');
      indicators[slideIndex].classList.add('active');

      currentSlide = slideIndex;

      // Reiniciar autoplay
      clearInterval(autoplayInterval);
      startAutoplay();
    }

    // Funci√≥n para avanzar al siguiente slide
    function nextSlide() {
      currentSlide = (currentSlide + 1) % totalSlides;
      goToSlide(currentSlide);
    }

    // Iniciar autoplay (cambia cada 5 segundos)
    function startAutoplay() {
      autoplayInterval = setInterval(nextSlide, 5000);
    }

    // Inicializar gr√°ficos con Chart.js
    function initCharts() {
      // Gr√°fico 1: KPIs Principales (L√≠nea)
      const kpiCtx = document.getElementById('kpiChart');
      if (kpiCtx) {
        charts.kpi = new Chart(kpiCtx, {
          type: 'line',
          data: {
            labels: ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'],
            datasets: [{
              label: 'Producci√≥n',
              data: [1050, 1120, 1180, 1240, 1190, 1210, 1247],
              borderColor: '#667eea',
              backgroundColor: 'rgba(102, 126, 234, 0.1)',
              tension: 0.4,
              fill: true
            }, {
              label: 'OEE (%)',
              data: [84, 85, 86, 88, 87, 86, 87.5],
              borderColor: '#764ba2',
              backgroundColor: 'rgba(118, 75, 162, 0.1)',
              tension: 0.4,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: 'top' }
            }
          }
        });
      }

      // Gr√°fico 2: Costes Operativos (Dona)
      const costCtx = document.getElementById('costChart');
      if (costCtx) {
        charts.cost = new Chart(costCtx, {
          type: 'doughnut',
          data: {
            labels: ['Mano de Obra (45%)', 'Materiales (35%)', 'Energ√≠a (12%)', 'Mantenimiento (8%)'],
            datasets: [{
              data: [12450, 9820, 3280, 2210],
              backgroundColor: ['#667eea', '#764ba2', '#f093fb', '#4facfe']
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: 'bottom' }
            }
          }
        });
      }

      // Gr√°fico 3: Producci√≥n Semanal (Barras)
      const productionCtx = document.getElementById('productionChart');
      if (productionCtx) {
        charts.production = new Chart(productionCtx, {
          type: 'bar',
          data: {
            labels: ['Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b', 'Dom'],
            datasets: [{
              label: 'Meta',
              data: [1200, 1200, 1200, 1200, 1200, 1200, 1200],
              backgroundColor: 'rgba(102, 126, 234, 0.3)',
              borderColor: '#667eea',
              borderWidth: 2
            }, {
              label: 'Real',
              data: [1240, 1280, 1310, 1290, 1250, 1230, 1247],
              backgroundColor: 'rgba(118, 75, 162, 0.7)',
              borderColor: '#764ba2',
              borderWidth: 2
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: 'top' }
            }
          }
        });
      }

      // Gr√°fico 4: Rentabilidad (L√≠nea con √°rea)
      const profitCtx = document.getElementById('profitChart');
      if (profitCtx) {
        charts.profit = new Chart(profitCtx, {
          type: 'line',
          data: {
            labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
            datasets: [{
              label: 'Ingresos (‚Ç¨)',
              data: [120000, 125000, 132000, 128000, 138000, 142300],
              borderColor: '#667eea',
              backgroundColor: 'rgba(102, 126, 234, 0.2)',
              tension: 0.4,
              fill: true
            }, {
              label: 'Costes (‚Ç¨)',
              data: [85000, 87000, 92000, 89000, 95000, 98450],
              borderColor: '#f093fb',
              backgroundColor: 'rgba(240, 147, 251, 0.2)',
              tension: 0.4,
              fill: true
            }, {
              label: 'Margen (‚Ç¨)',
              data: [35000, 38000, 40000, 39000, 43000, 43850],
              borderColor: '#4facfe',
              backgroundColor: 'rgba(79, 172, 254, 0.2)',
              tension: 0.4,
              fill: true
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { position: 'top' }
            }
          }
        });
      }

      // Gr√°fico 5: Tiempo de Inactividad (Barras horizontales)
      const downtimeCtx = document.getElementById('downtimeChart');
      if (downtimeCtx) {
        charts.downtime = new Chart(downtimeCtx, {
          type: 'bar',
          data: {
            labels: ['Tiempo Productivo', 'Paradas No Planificadas', 'Mantenimiento', 'Cambios de Turno'],
            datasets: [{
              label: 'Porcentaje (%)',
              data: [92.3, 4.2, 2.8, 0.7],
              backgroundColor: ['#4facfe', '#f093fb', '#764ba2', '#667eea']
            }]
          },
          options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false }
            }
          }
        });
      }
    }

    // Inicializar cuando se carga la p√°gina
    document.addEventListener('DOMContentLoaded', function() {
      initCharts();
      startAutoplay();
    });

    // ====== FIN DASHBOARD ECON√ìMICO ======

    function calcRatingAverage() {
      const ratingSelects = document.querySelectorAll('.ratingSelect');
      let sum = 0, count = 0;
      ratingSelects.forEach(sel => {
        const val = parseInt(sel.value);
        if (!isNaN(val)) { sum += val; count++; }
      });
      document.getElementById('averageRating').textContent = (count>0 ? sum/count : 0).toFixed(2);
    }

    function onValueChanged() {
      calcRatingAverage();
      document.querySelectorAll('.ratingSelect').forEach(function(select) {
        const row = select.closest('tr');
        if (select.value === "1") row.style.backgroundColor = 'red';
        else if (select.value === "2") row.style.backgroundColor = 'orange';
        else if (select.value === "3") row.style.backgroundColor = 'yellow';
        else row.style.backgroundColor = '';
      });
    }

    function previewImage(input) {
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onload = function(e) {
          let preview = input.parentElement.querySelector('img.preview');
          if (!preview) {
            preview = document.createElement('img');
            preview.className = 'preview';
            input.parentElement.appendChild(preview);
          }
          preview.src = e.target.result;
        };
        reader.readAsDataURL(input.files[0]);
      }
    }

    function addPostit() {
      const container = document.createElement("div");
      container.className = "postit";
      const colorInput = document.createElement("input");
      colorInput.type = "color";
      colorInput.value = "#ffffcc";
      colorInput.addEventListener("input", function(){ container.style.backgroundColor = colorInput.value; });
      const fileInput = document.createElement("input");
      fileInput.type = "file";
      fileInput.accept = "image/*";
      fileInput.style.display = "block";
      fileInput.addEventListener("change", function(){ previewImage(fileInput); });
      const textarea = document.createElement("textarea");
      textarea.className = "comentario-textarea";
      textarea.placeholder = "A√±ade aqu√≠ tu comentario...";
      container.appendChild(colorInput);
      container.appendChild(fileInput);
      container.appendChild(textarea);
      document.getElementById("comentariosContainer").appendChild(container);
    }

    // Actualiza el t√≠tulo seg√∫n la l√≠nea seleccionada
    document.getElementById('linea').addEventListener('change', function(){
      const lineaSeleccionada = this.value;
      document.getElementById('lineaTitulo').textContent = lineaSeleccionada ? lineaSeleccionada.replace('L√≠nea ', '') : '3';
    });

    async function generarPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p', 'pt', 'a4');
      const scale = 2;

      const element = document.body;
      await html2canvas(element, { scale: scale, useCORS: true, logging: false }).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const pdfWidth = doc.internal.pageSize.getWidth();
        const pdfHeight = doc.internal.pageSize.getHeight();
        const imgProps = doc.getImageProperties(imgData);
        const imgWidth = pdfWidth;
        const imgHeight = (imgProps.height * pdfWidth) / imgProps.width;
        let heightLeft = imgHeight;
        let position = 0;

        doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
        heightLeft -= pdfHeight;

        while (heightLeft > 0) {
          position = heightLeft - imgHeight;
          doc.addPage();
          doc.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
          heightLeft -= pdfHeight;
        }

        const fecha = document.getElementById('fecha').value || new Date().toISOString().slice(0, 10);
        const turno = document.getElementById('turno').value || 'sin_turno';
        const responsable = document.getElementById('responsable').value || 'sin_responsable';
        const modelo = document.getElementById('modelo').value || 'sin_modelo';
        const linea = document.getElementById('linea').value || 'sin_linea';
        const idAgua = (document.getElementById('idProbetaAgua')?.value || '').trim();
        const idAdh  = (document.getElementById('idProbetaAdhesivo')?.value || '').trim();

        function safe(s){ return s.replace(/\s+/g, '_'); }
        const parts = ['flash_audit', fecha, safe(turno), safe(responsable), safe(modelo), safe(linea)];
        if (idAgua) parts.push('agua_' + safe(idAgua));
        if (idAdh)  parts.push('adh_'  + safe(idAdh));

        doc.save(parts.join('_') + '.pdf');
        // Alternativa m√≥vil: abrir en nueva pesta√±a y compartir
        // doc.output('dataurlnewwindow');
      });
    }
  </script>

</body>
</html>
